# Retroznak Land 2.0 — Руководство для Codex-агента

## 0. Обзор репозитория
- **`architecture.md`** — подробная схема архитектуры Next.js-приложения, включая директории `app/`, `src/`, `public/` и набор инфраструктурных инструментов (Tailwind, shadcn/ui, Framer Motion, Swiper, Nodemailer).
- **`wireframe.md`** — текстовый вайрфрейм всех секций лендинга, описывает требуемый контент, CTA и пользовательские сценарии.
- Фактический код проекта ещё не создан. Настоящий документ задаёт план разработки и контрольные точки.

## 1. Правила работы со статусами
- Каждая задача помечается одним из статусов: `⚙️ текущая задача`, `✅ выполнено`, `⛔ не выполнено`.
- В рамках этапа одновременно может быть только одна `⚙️ текущая задача`.
- После завершения работ и успешного прохождения всех проверок статус переводится в `✅ выполнено`.
- Если задача заблокирована, содержит дефекты или требует ручной доработки — ставится `⛔ не выполнено` с кратким комментарием о проблеме.

## 2. Этапы и контрольный чек-лист
Используем два этапа, каждый из которых содержит не более трёх задач. Выполняй этапы последовательно: переход к следующему этапу возможен только после завершения всех задач предыдущего.

### Этап A. Базовая инфраструктура проекта
1. **`[✅]` A1 — Инициализировать каркас Next.js 14 (App Router, TypeScript)**  
   **Статус:** ✅ выполнено — создан Next.js 15 каркас с типизацией, базовым маркетинговым layout и скриптами dev/build/test/typecheck.  
   **Суть:** создать директории и файлы согласно `architecture.md`, настроить `tsconfig.json`, `package.json`, scripts (`dev`, `build`, `start`, `lint`, `test`, `typecheck`).  
   **Ключевые файлы:** `app/layout.tsx`, `app/page.tsx`, `package.json`, `tsconfig.json`, `next.config.mjs`.  
   **Проверки:** `npm run lint`, `npm run typecheck`, `npm run test` (если тестов ещё нет — зафиксируй пропуск и причину).  
   **Результат:** рабочее приложение с пустым маркетинговым layout и базовыми метаданными.

2. **`[✅]` A2 — Настроить стили и UI-инфраструктуру**  
   **Статус:** ✅ выполнено — Tailwind CSS и shadcn/ui подключены, настроена брендовая тема и шрифты Noto Serif + Manrope.  
   **Комментарий:** Прогон `npm run lint`, `npm run typecheck`; ручной просмотр через `npm run dev` — стартовая страница открывается без ошибок, базовые компоненты отображаются корректно.  
   **Суть:** подключить Tailwind CSS и shadcn/ui, сформировать тему (цвета `retro-charcoal`, `retro-graphite`, `retro-smoke`, `retro-ivory`, `accent-platinum`), добавить шрифты `Noto Serif` и `Manrope`.  
   **Ключевые файлы:** `tailwind.config.ts`, `postcss.config.js`, `src/styles/globals.css`, `src/styles/tailwind.css`, сгенерированные компоненты shadcn/ui в `components/ui/`.  
   **Проверки:** `npm run lint`, `npm run typecheck`, локальный просмотр через `npm run dev` (задокументировать ручную проверку в комментариях к задаче).

3. **`[ ]` A3 — Организовать контентный слой и утилиты**  
   **Статус:** -  
   **Суть:** создать структуры `src/content/`, `src/types/`, `src/lib/`, заполнить типы (`TimelineItem`, `ProductCard`, формы и т.д.), подготовить заглушки контента на основе `wireframe.md`.  
   **Ключевые файлы:** `src/types/content.ts`, `src/content/*.ts`, `src/lib/analytics.ts`, `src/lib/mailer.ts`, `src/hooks/useContactForm.ts`.  
   **Проверки:** `npm run lint`, `npm run typecheck`, модульные тесты утилит (`npm run test`).

### Этап B. Функциональные секции и интеграции
1. **`[ ]` B1 — Реализовать маркетинговые секции лендинга**  
   **Статус:** -  
   **Суть:** собрать компоненты из каталога `app/(marketing)/components/` согласно `wireframe.md` (Hero, Timeline, Segments, ProductMatrix, Production, Reviews, OrderProcess, FAQ, Final CTA, FloatingMenu, MobileNavDrawer). Использовать Framer Motion, Swiper и `next/image`.  
   **Ключевые файлы:** `app/(marketing)/page.tsx`, `app/(marketing)/layout.tsx`, соответствующие компоненты в `app/(marketing)/components/`.  
   **Проверки:** `npm run lint`, `npm run typecheck`, `npm run test`, ручная вёрсточная проверка в браузере.

2. **`[ ]` B2 — Настроить формы и серверные маршруты**  
   **Статус:** -  
   **Суть:** внедрить формы (Callback, Consultation, Question) на базе React Hook Form + Zod, реализовать API Route `app/api/forms/contact/route.ts` с отправкой письма через Nodemailer и валидацией.  
   **Ключевые файлы:** `app/(marketing)/components/Forms/*.tsx`, `app/api/forms/contact/route.ts`, `src/types/forms.ts`, `src/lib/mailer.ts`.  
   **Проверки:** `npm run lint`, `npm run typecheck`, `npm run test`, интеграционный тест API (можно Vitest + supertest) и ручная отправка с тестовым SMTP.

3. **`[ ]` B3 — Финализация, оптимизация и подготовка к релизу**  
   **Статус:** -  
   **Суть:** добавить SEO-настройки (Metadata API), подключить аналитику (`lib/analytics.ts`), проверить Lighthouse рекомендации, подготовить документацию по деплою. Провести финальный аудит доступа к ассетам (`public/images`, `public/pdf`).  
   **Ключевые файлы:** `app/layout.tsx`, `lib/analytics.ts`, `public/**`, инструкции в `README.md` (создать или дополнить).  
   **Проверки:** полный прогон `npm run lint`, `npm run typecheck`, `npm run test`, `npm run build`, ручная Smoke-проверка production-сборки через `npm run start`.

> **Важно:** после выполнения каждой задачи фиксируй статус и краткое резюме в комментарии внутри этого чек-листа или в сопроводительном отчёте к коммиту. Любые пропуски проверок документируй с причиной.

## 3. Инструкции по тестированию и развёртыванию

### 3.1 DEV-проверка на Windows
1. Установить Node.js 18 LTS и npm (проверить командой `node -v`, `npm -v`).
2. Склонировать репозиторий и выполнить `npm install`.
3. Скопировать `.env.example` в `.env.local`, заполнить заглушки SMTP (`test@test.ru`), ссылки на мессенджеры и параметры аналитики.
4. Запустить дев-сервер: `npm run dev`. Проверить:
   - загрузку всех секций из `wireframe.md`;
   - работу адаптивного меню и Swiper-слайдеров;
   - отправку форм на тестовый SMTP (должно возвращать 200 и отображать toast-уведомления).
5. Прогнать проверки качества: `npm run lint`, `npm run typecheck`, `npm run test`.
6. При необходимости запустить предварительную сборку: `npm run build` и smoke-тест `npm run start`.

### 3.2 PROD-выкладка на Beget
1. Подготовить продакшен-ветку и убедиться, что все задачи из чек-листа помечены `✅ выполнено`.
2. На сервере Beget установить Node.js 18+ и npm, подготовить директорию проекта.
3. Скопировать `.env.production` с боевыми SMTP и аналитикой (без коммита в git).
4. Выполнить на сервере:
   ```bash
   git pull
   npm ci
   npm run build
   npm run start
   ```
   При использовании PM2 — создать/обновить `ecosystem.config.js` и запустить `pm2 restart retroznak`.
5. Проверить:
   - корректность ответа API-роута `/api/forms/contact`;
   - доступность статических файлов (`/images`, `/pdf`).
6. Зафиксировать результат деплоя и обновить статусы задач. В случае нештатных ситуаций отметить соответствующие задачи как `⛔ не выполнено` и добавить комментарий.

---
Этот документ является источником правды для планирования и контроля разработки. Обновляй его при появлении новых требований, но сохраняй структуру этапов и статусов.
